---
title: ä» 0 å¼€å§‹ä½¿ç”¨ ESLint
date: 2019-12-14 12:09:48
category:
  - ESLint
  - å‰ç«¯å·¥å…·
---

æˆ‘ä»¬æœ‰å¾ˆå¤šçš„ç†ç”±å»åšä»£ç æ£€æŸ¥ã€‚

æ¯”å¦‚ï¼Œéšç€é¡¹ç›®è§„æ¨¡å¢å¤§æ—¶ï¼Œå¾ˆå°çš„é”™è¯¯éƒ½å¯èƒ½å¯¼è‡´é¡µé¢å¼‚å¸¸ï¼Œä¸ä»…å½±å“ç”¨æˆ·ä½¿ç”¨ï¼Œè¿˜è¦è€—è´¹å¤§é‡æ—¶é—´æ¥è°ƒè¯•ã€‚è€ŒåŸå› å¯èƒ½æ˜¯æœ‰ä¸ªå°ä¼™ä¼´æ‰‹æŠ–å¤šæ‰“äº†ä¸€ä¸ªå­—ç¬¦ï¼Œä¸­é€”å»åšå…¶ä»–äº‹æƒ…äº†ï¼Œå¯¼è‡´ä»£ç å†™äº†ä¸€åŠâ€¦â€¦æˆ‘ä»¬ä¸èƒ½æŒ‡æœ›è‚‰çœ¼è§£å†³æ‰€æœ‰é—®é¢˜ã€‚

å¦‚æœèƒ½æœ‰ä¸€ä¸ªè¶æ‰‹çš„ä»£ç æ£€æŸ¥å·¥å…·ï¼Œå¸®åŠ©æˆ‘ä»¬å»åšä»£ç æ£€æŸ¥ï¼Œè¯¥æœ‰å¤šå¥½ï¼Ÿè¿™ä¾¿æ˜¯æœ¬æ–‡çš„ç›®çš„ï¼Œ`ä»0åˆ°1`å¸¦é¢†å¤§å®¶å°† ESLint åº”ç”¨åˆ°æˆ‘ä»¬çš„å¼€å‘ç¯å¢ƒå½“ä¸­ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼

## åŸºæœ¬é…ç½®

```bash
yarn add eslint --dev
```

æœ‰äº† ESLint ä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡å®ƒæ¥æ£€æŸ¥æŒ‡å®šçš„ä»£ç æ–‡ä»¶äº†ã€‚æˆ‘ä»¬åœ¨ npm scripts åŠ å…¥å¦‚ä¸‹è„šæœ¬

```json
{
  ...
  "scripts": {
    ...
    "test-eslint": "eslint src/**/*.js src/**/*.jsx"
    ...
  }
  ...
}
```

åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ `yarn run test-eslint` ä¼šæç¤ºç¼ºå°‘ ESLint çš„é…ç½®

```bash
yarn run v0.23.2
eslint src/**/*.js src/**/*.jsx

Oops! Something went wrong! :(

ESLint couldn't find a configuration file. To set up a configuration file for this project, please run:

    eslint --init

ESLint looked for configuration files in /Users/mytream/WebstormProjects/tezign-web-customer/src/common and its ancestors.

If you think you already have a configuration file or if you need more help, please stop by the ESLint chat room: https://gitter.im/eslint/eslint

error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.

```

ä¸‹é¢æˆ‘ä»¬å°±å‡†å¤‡é…ç½®é…ç½®æ–‡ä»¶ `.eslintrc`

```bash
touch .eslintrc
yarn run test-eslint
```

æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯

```bash
/Users/mytream/WebstormProjects/tezign-web-customer/src/common/cache.js
  3:1  error  Parsing error: The keyword 'export' is reserved

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/constants.js
  1:5  error  Parsing error: Unexpected token pkg

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/dom.js
  1:1  error  Parsing error: The keyword 'import' is reserved

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/enum.js
  3:1  error  Parsing error: The keyword 'const' is reserved

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/history.js
  1:1  error  Parsing error: The keyword 'import' is reserved
```

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰åœ¨é…ç½®æ–‡ä»¶`.eslintrc`ä¸­é…ç½® parserOptions æ¥æŒ‡å®šè¯­è¨€ç‰ˆæœ¬ä¸ºå’Œæ¨¡å—ç±»å‹ã€‚

äºæ˜¯æˆ‘ä»¬åœ¨`.eslintrc`æ·»åŠ å¦‚ä¸‹é…ç½®, æŒ‡å®š es ç‰ˆæœ¬ ecmaVersion ä¸º 7ï¼Œä¹Ÿå°±æ˜¯ es2016, æŒ‡å®šæ¨¡å—ç±»å‹ sourceType ä¸º moduleï¼Œå¦‚æ­¤ä¾¿æ”¯æŒ export å’Œ import æ¥å¯¼å‡ºå¹¶å¼•ç”¨æ–‡ä»¶

```json
{
  "parserOptions": {
    "ecmaVersion": 7,
    "sourceType": "module"
  }
}
```

å†æ‰§è¡Œ`yarn run test-eslint`ä¹‹åï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯

```terminal
/Users/mytream/WebstormProjects/tezign-web-customer/src/containers/Root.jsx
  110:5  error  Parsing error: Unexpected token <

/Users/mytream/WebstormProjects/tezign-web-customer/src/layouts/default.jsx
  14:7  error  Parsing error: Unexpected token <

/Users/mytream/WebstormProjects/tezign-web-customer/src/layouts/screen.jsx
  9:7  error  Parsing error: Unexpected token <

/Users/mytream/WebstormProjects/tezign-web-customer/src/views/404.jsx
  21:7  error  Parsing error: Unexpected token <
```

ESLint è¿˜ä¸èƒ½è¯†åˆ« JSX è¯­æ³•ï¼Œæˆ‘ä»¬æ·»åŠ å¦‚ä¸‹é…ç½®

```json
{
  "parserOptions": {
    "ecmaVersion": 7,
    "sourceType": "module",
    "ecmaFeatures": {
      // æ·»åŠ ESç‰¹æ€§æ”¯æŒï¼Œä½¿ä¹‹èƒ½å¤Ÿè¯†åˆ«ES6è¯­æ³•
      "jsx": true
    }
  }
}
```

> ESLint é…ç½®æ–‡ä»¶ä¸­æ˜¯æ”¯æŒè¡Œåæ³¨é‡Šçš„

å¦‚æ­¤ï¼Œ`test-eslint`ä¹‹åï¼Œæ£€æŸ¥å°±é€šè¿‡äº†ã€‚

æ€ä¹ˆä¼šè¿™ä¹ˆé¡ºåˆ©å‘¢ï¼Ÿæ€ä¹ˆå¯èƒ½ä¸€è¡Œè­¦å‘Šæˆ–æŠ¥é”™éƒ½æ²¡æœ‰å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º ESLint é…ç½®æ–‡ä»¶é»˜è®¤æ˜¯ä¸æä¾›ä»»ä½•ä»£ç çš„æ£€æŸ¥è§„åˆ™çš„ï¼Œè¿™éƒ½éœ€è¦æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œã€‚äºæ˜¯æˆ‘ä»¬æ·»åŠ ä¸‹é¢ä¸¤è¡Œè§„åˆ™ï¼š

```json
{
  ...
  "rules": {
    "semi": "warn"
  }
  ...
}
```

æ§åˆ¶å°å¼€å§‹å‡ºç°å¤§é‡çš„è­¦å‘Šä¿¡æ¯ï¼š

```terminal
/Users/mytream/WebstormProjects/tezign-web-customer/src/common/cache.js
  38:47  warning  Missing semicolon  semi

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/dom.js
  1:23  warning  Missing semicolon  semi

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/history.js
  1:43  warning  Missing semicolon  semi

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/http.js
    3:32  warning  Missing semicolon  semi
    5:36  warning  Missing semicolon  semi
    6:26  warning  Missing semicolon  semi
    7:40  warning  Missing semicolon  semi
  103:7   warning  Missing semicolon  semi
  107:5   warning  Missing semicolon  semi

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/notice.js
  16:4  warning  Missing semicolon  semi
  17:3  warning  Missing semicolon  semi
```

æˆ‘ä»¬è®¾ç½®çš„è§„åˆ™ `"semi": "warn"` ç”Ÿæ•ˆäº†ï¼Œè§„åˆ™`semi`çš„æ„æ€æ˜¯è¡Œæœ«å¿…é¡»ä½¿ç”¨åˆ†å·ï¼Œå®ƒçš„å€¼å¯ä»¥æ˜¯"off"(æˆ– 0), "warn"(æˆ–
1), "error"(æˆ– 2)ï¼Œå…·ä½“å«ä¹‰ä¹Ÿå¾ˆæ˜ç¡®ã€‚

é¡µé¢[è§„åˆ™](http://eslint.cn/docs/rules/)ä¸‹åˆ—å‡ºäº† ESLint å†…éƒ¨æ”¯æŒçš„æ‰€æœ‰çš„è§„åˆ™ï¼ŒåŒ…å«å¯èƒ½çš„é”™è¯¯ã€æœ€ä½³å®è·µã€å˜é‡ä½¿ç”¨ç­‰ç­‰åˆ†ç±»çš„è§„åˆ™ï¼Œæˆ‘ä»¬åªè¦æ ¹æ®éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æˆ‘ä»¬éœ€è¦æ ¡éªŒçš„è§„åˆ™å³å¯ã€‚

å½“ç„¶æˆ‘ä»¬ä¸æƒ³æ‰‹åŠ¨çš„åŠ å…¥è¿™ä¹ˆå¤šè§„åˆ™ï¼Œæˆ‘ä»¬ä½¿ç”¨ `extends` å…³é”®å­—åŠ å…¥ ESLint æ¨èçš„è§„åˆ™ã€‚åŒæ—¶æˆ‘ä»¬å…³é—­ï¼ˆè¦†ç›–ï¼‰æ‰ `semi` è§„åˆ™çš„æ£€æŸ¥ã€‚

```json
{
  ...
  "extends": "eslint:recommended",
  "rules": {
    "semi": "off"
  }
  ...
}
```

æ ¡éªŒç»“æœå‡ºæ¥äº†ï¼Œä¹Ÿæ²¡æœ‰å†å¯¹åˆ†å·è¿›è¡Œæ ¡éªŒï¼Œè¿™å¾ˆå¥½ï¼Œæœ‰çš„åŒå­¦å–œæ¬¢è¿™æ ·çš„é£æ ¼ï¼Œæˆ‘ä»¬ä¸æƒ³å¼ºåˆ¶ã€‚

```terminal
/Users/mytream/WebstormProjects/tezign-web-customer/src/common/cache.js
   5:16  error  'Promise' is not defined            no-undef
   5:43  error  'reject' is defined but never used  no-unused-vars
   6:7   error  'localStorage' is not defined       no-undef
  12:16  error  'Promise' is not defined            no-undef
  15:15  error  'localStorage' is not defined       no-undef
  22:16  error  'Promise' is not defined            no-undef
  22:43  error  'reject' is defined but never used  no-unused-vars
  25:9   error  'localStorage' is not defined       no-undef
  31:16  error  'Promise' is not defined            no-undef
  31:43  error  'reject' is defined but never used  no-unused-vars
  33:7   error  'localStorage' is not defined       no-undef
  38:5   error  'window' is not defined             no-undef
  41:5   error  'window' is not defined             no-undef

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/constants.js
   1:11  error  'require' is not defined        no-undef
  18:4   error  '__DEV_MODEL__' is not defined  no-undef
  22:5   error  '__DEV__' is not defined        no-undef
  25:5   error  '__QA__' is not defined         no-undef
  28:5   error  '__YZ__' is not defined         no-undef
  31:5   error  '__DEMO__' is not defined       no-undef
  34:5   error  '__PROD__' is not defined       no-undef
```

æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å…¶ä»–çš„ç»“æœï¼ŒPromiseã€window æç¤ºæœªå®šä¹‰æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šä»£ç æ‰§è¡Œçš„ç¯å¢ƒ es6 å’Œ browser, è¿™å¯ä»¥åœ¨`env`é…ç½®ä¸­æ·»åŠ ã€‚**DEV** **QA** è¿™äº›é…ç½®å­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸ºå…¨å±€å˜é‡

```json
{
  ...
  "env": {
    "es6": true,
    "browser": true
  },
  "globals": {
    "__DEV_MODEL__": true,
    "__DEV__": true,
    "__QA__": true,
    "__YZ__": true,
    "__DEMO__": true,
    "__PROD__": true
  }
  ...
}
```

å†æ¬¡æ‰§è¡Œä¹‹åï¼Œæˆ‘ä»¬çœ‹åˆ°äº†çœŸæ­£æƒ³è¦çš„æ£€æŸ¥ç»“æœ ğŸ˜„

```terminal
/Users/mytream/WebstormProjects/tezign-web-customer/src/common/cache.js
   5:43  error  'reject' is defined but never used  no-unused-vars
  22:43  error  'reject' is defined but never used  no-unused-vars
  31:43  error  'reject' is defined but never used  no-unused-vars

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/constants.js
  1:11  error  'require' is not defined  no-undef

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/dom.js
  132:24  error  'getPageOffset' is not defined  no-undef

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/history.js
  13:3  error  '_' is not defined  no-undef

/Users/mytream/WebstormProjects/tezign-web-customer/src/common/http.js
   7:9   error  'message' is defined but never used  no-unused-vars
  10:40  error  'err' is defined but never used      no-unused-vars
  13:38  error  'err' is defined but never used      no-unused-vars
  16:38  error  'err' is defined but never used      no-unused-vars
```

æˆ‘ä»¬è¦åšçš„å°±æ˜¯ï¼Œå»ä¿®æ”¹è¿™äº›é”™è¯¯å°±å¯ä»¥äº†ã€‚

### ESLint è§„åˆ™çš„æ‰©å±•

åˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬éƒ½å¾ˆé¡ºåˆ©ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰é’ˆå¯¹ reactã€vue ç”šè‡³ angular ç›¸å…³çš„ä¸€äº›æ£€æŸ¥è§„åˆ™å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæµ‹è¯•æ¡†æ¶æ¯”å¦‚ jest é›†æˆåˆ°è¿™ä¸ªæµç¨‹å½“ä¸­æ¥å‘¢ï¼Ÿå¤§å®¶å¯ä»¥æŸ¥çœ‹[awesome-eslint](https://github.com/dustinspecker/awesome-eslint)æ¥æŸ¥çœ‹ç¤¾åŒºä¸ºæˆ‘ä»¬æä¾›çš„å·¥å…·ã€æ’ä»¶ã€é…ç½®ç”šè‡³å­¦ä¹ æ–‡æ¡£ã€‚

æˆ‘ä»¬ä»¥æ’ä»¶`eslint-plugin-react`ä¸ºä¾‹ï¼Œå¢åŠ  react ç›¸å…³çš„æ£€æŸ¥è§„åˆ™ã€‚é¦–å…ˆï¼Œéœ€è¦å®‰è£…è¿™ä¸ªæ’ä»¶ï¼Œç„¶ååœ¨.eslintrc å¢åŠ ç›¸åº”çš„é…ç½®

```bash
# å¢åŠ æ’ä»¶
yarn add --dev eslint-plugin-react

# æ·»åŠ reactæ£€æŸ¥è§„åˆ™ï¼Œå¹¶ä¸”æ’é™¤æˆ‘ä»¬ä¸æƒ³è¦çš„è§„åˆ™
{
  "extends": [
    "eslint:recommended",
    "plugin:react/recommended"
  ],
  "rules": {
    ...
    "react/prop-types": "off"
  },
}
```

æ£€æŸ¥ä¹‹åæˆ‘ä»¬è·å¾—äº†æƒ³è¦çš„ç»“æœ

```terminal
     :11  error  Unexpected console statement                           no-console
  147:11  error  Unexpected console statement                           no-console
  388:20  error  Using this.refs is deprecated                          react/no-string-refs
  393:5   error  Unexpected console statement                           no-console
  404:5   error  Using this.refs is deprecated                          react/no-string-refs
  414:30  error  '_' is not defined                                     no-undef
  490:21  error  Using string literals in ref attributes is deprecated  react/no-string-refs
  518:34  error  Using string literals in ref attributes is deprecated  react/no-string-refs
```

æœ‰çš„å°ä¼™ä¼´åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šæç¤ºï¼Œæ¨¡å—`eslint-plugin-react`æ‰¾ä¸åˆ°ï¼Œè¿™æ˜¯å› ä¸ºä½ çš„ eslit å’Œ æ’ä»¶ä¸åœ¨ä¸€ä¸ªç¯å¢ƒä¸‹ï¼Œè¦ä¹ˆéƒ½æ˜¯å…¨å±€çš„ï¼Œè¦ä¹ˆéƒ½åœ¨å·¥ç¨‹ä¸‹çš„ `node_modules` ä¸­ã€‚

ä¸è¿‡æˆ‘ä»¬å»ºè®®éƒ½å®‰è£…åœ¨ node_modules ä¸‹é¢,å¹¶ä¸”è®°å½•åˆ° package.json ä¸­ï¼Œæ–¹ä¾¿å…¶ä»–å°ä¼™ä¼´ä½¿ç”¨ã€‚

### å°† ESLint æ•´åˆåˆ° Git æµç¨‹

So far so good ! å”¯ä¸€è®©æˆ‘ä»¬æ„Ÿè§‰ä¸å¤Ÿå®Œç¾çš„å°±æ˜¯æ¯æ¬¡æˆ‘ä»¬æƒ³åš eslitn æ£€æŸ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½è¦æ‰‹åŠ¨çš„æ‰§è¡Œä¸€ä¸‹`yarn run test-eslint`ã€‚èƒ½ä¸èƒ½åœ¨æˆ‘æäº¤ä»£ç çš„æ—¶å€™ç»™æˆ‘è‡ªåŠ¨æ£€æŸ¥ï¼ˆå¼ºåˆ¶æ£€æŸ¥ ğŸ˜‹ï¼‰ã€‚

ç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚è¿˜å·®æœ€åå‡ æ­¥æˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™ä¸€å¥—åº”ç”¨äºå¼€å‘ç¯å¢ƒäº†ã€‚

```json
// ä½¿ç”¨huskyæ¥è®¾ç½®git hooks
yarn add husky --dev

# åœ¨npm scriptsä¸­å¢åŠ precommit prepushï¼ˆå¿…é¡»è¿™ä¹ˆæ‹¼å†™ï¼‰
{
  "scripts": {
    "precommit": "npm run test-eslint",
    "prepush": "npm run test-eslint",
    "test-eslint": "eslint src/**/*.js src/**/*.jsx"
    ...
  }
}
```

ä¹‹åæˆ‘ä»¬ä¾¿ç›´æ¥ commit ä»£ç 

```bash
git commit -m 'eslint before commit'
husky > npm run -s precommit (node v8.1.4)
/Users/mytream/WebstormProjects/tezign-web-customer/src/common/cache.js
   5:43  error  'reject' is defined but never used  no-unused-vars
  22:43  error  'reject' is defined but never used  no-unused-vars
  31:43  error  'reject' is defined but never used  no-unused-vars
...
```

æˆ‘ä»¬æäº¤å¤±è´¥äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æœŸæœ›çš„ç»“æœï¼Œåªæœ‰æŠŠä¿¡æ¯ä¸­æåˆ°çš„é—®é¢˜éƒ½ä¿®æ”¹æ‰ï¼Œæ‰èƒ½æäº¤æˆåŠŸã€‚

åœ¨ä¸€äº›ç´§æ€¥æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é©¬ä¸Šæäº¤ä»£ç ï¼Œéœ€è¦è·³è¿‡æ£€æŸ¥ï¼ŒåŠ ä¸Š`-n` é€‰é¡¹æ—¢å¯

```bash
git commit -m 'eslint before commit' -n
```

### æ€»ç»“

åœ¨å‰é¢æˆ‘ä»¬ä» 0 åˆ° 1 ä»‹ç»äº† ESLint åœ¨å¼€å‘ç¯å¢ƒä¸­çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹ã€‚

- å®‰è£… ESLint åŠç›¸å…³æ’ä»¶æˆ–é…ç½®
- ESLint åŸºæœ¬é…ç½®ï¼šè¯­è¨€é€‰é¡¹ã€è¿è¡Œç¯å¢ƒã€å…¨å±€å˜é‡ã€è§„åˆ™é€‰é¡¹ç­‰
- ESLint plugin åŠ config é…ç½®ï¼šESLint çš„æ‰©å±•ç‰¹æ€§
- å°† ESLint æ£€æŸ¥é›†æˆåˆ° git hooks å½“ä¸­

æ‰€ä»¥ï¼Œä½ å‡†å¤‡å¥½ä½¿ç”¨ ESLint æ¥åšä»£ç æ£€æŸ¥äº†å—ï¼Ÿ

### å‚è€ƒèµ„æ–™

- [å®˜æ–¹æ–‡æ¡£](https://eslint.org/) ï¼ˆ[ä¸­æ–‡](http://eslint.cn/)ï¼‰
- [A Comparison of js Linting Tools](https://www.sitepoint.com/comparison-javascript-linting-tools/)
- [MDN ESlint](https://developer.mozilla.org/en-US/docs/ESLint)
- [awesome-eslint](https://github.com/dustinspecker/awesome-eslint)
