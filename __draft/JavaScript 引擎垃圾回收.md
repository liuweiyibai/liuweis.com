---
title: JavaScript 引擎垃圾回收
date: 2020-10-08 16:49:54
category:
  - JavaScript
  - 浏览器原理
draft: true
---

## 简介

JavaScript 引擎在创建变量（对象、字符串等）时分配内存，并在不再使用时**自动**释放它，这个过程称为垃圾收集。
自动释放资源的这种看似**自动**的过程，其实会导致一些 JavaScript 使用者忽略内存管理这回事。在自动内存管理中存在一些问题（例如垃圾收集器中的错误或实现限制等），开发人员必须了解这些问题才能正确处理它们。

下面先说说 JavaScript 引擎，以 chrome 的 V8 引擎为例，下面简单介绍一下

## V8 引擎

V8 是 Google 发布的主流的开源 JavaScript 引擎，采用 C++ 编写。采用即时编译，直接翻译成机器语言，并且使用了内联缓存（inline caching）等方法来提高性能。有了这些功能，JavaScript 程序在 V8 引擎下的运行速度媲美二进制程序。

V8 内存设限：

- 64bit 操作系统上不超过 1.5G
- 32bit 操作系统上不超过 800M

这就意味着，无法操作一些大内存的对象，比如一个几个 G 的文件。

这么设限为了浏览器使用内存足够，内部还有垃圾运行机制，时间也在用户感知的合理范围
目前 V8 垃圾回收采用增量标记算法需要 50ms，采用非增量标记算法需要 1s

在浏览器中，如果不幸发生内存泄露等问题，仅仅会影响到一个 Tab 的用户。且无论这个 V8 实例占用了多少内存，最终在关闭页面时其占用内存都会被释放，几乎没有太多管理的必要，但是对于一些大型 Web 应用还是需要管理内存。但如果使用 Node 作为服务器，就需要关注内存问题了，一旦内存发生泄漏，久而久之整个服务将会瘫痪。

## 垃圾回收
